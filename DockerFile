# Use a base image
FROM maven:3.9-eclipse-temurin-21 as builder

# Set working directory
WORKDIR /app

# Print log messages during the build process
RUN echo "Step 1: Preparing the build environment"

# Copy the pom.xml and log
COPY pom.xml ./
RUN echo "Step 2: Downloading dependencies"
RUN mvn dependency:go-offline -B

# Copy source code and log
COPY src ./src
RUN echo "Step 3: Building the project"
RUN mvn clean package -DskipTests

# Final runtime image
FROM eclipse-temurin:21-jre
WORKDIR /app

# Copy the built JAR and log
COPY --from=builder /app/target/*.jar app.jar
RUN echo "Step 4: Preparing the runtime environment"

# Print the final log message
RUN echo "Build process completed successfully!"

# Set entrypoint
ENTRYPOINT ["java", "-jar", "app.jar"]
